<div class="flowchart-container" *ngIf="request">
  <div class="flowchart-header">
    <h4>Flowchart View</h4>
    <div class="flowchart-info">
      <span>Duration: {{ request.duration }}ms</span>
      <span>Spans: {{ request.trace.spans.length }}</span>
    </div>
  </div>
  
  <div class="flowchart-content">
    <svg [attr.width]="svgWidth" [attr.height]="svgHeight" class="flowchart-svg">
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
          <polygon points="0 0, 10 3, 0 6" fill="#666" />
        </marker>
      </defs>
      
      <!-- Connections -->
      <g class="connections">
        <path
          *ngFor="let conn of connections"
          [attr.d]="getConnectionPath(conn.from, conn.to)"
          stroke="#666"
          stroke-width="2"
          fill="none"
          marker-end="url(#arrowhead)"
          opacity="0.6"
          class="connection-path"
        />
      </g>
      
      <!-- Nodes -->
      <g class="nodes">
        <g *ngFor="let node of nodes">
          <rect
            [attr.x]="node.x"
            [attr.y]="node.y"
            [attr.width]="node.width"
            [attr.height]="node.height"
            [attr.fill]="getSpanColor(node.span)"
            stroke="#fff"
            stroke-width="2"
            rx="8"
            class="flow-node"
            [class.error]="node.span.status === 'error'"
            [class.warning]="node.span.status === 'warning'"
            [class.processing]="node.span.status === 'processing'"
            (click)="onSpanClick(node.span)"
          />
          
          <text
            [attr.x]="node.x + node.width / 2"
            [attr.y]="node.y + 25"
            fill="#fff"
            font-size="14"
            font-weight="bold"
            text-anchor="middle"
            class="node-text"
          >
            {{ getServiceIcon(node.span.type) }} {{ node.span.name }}
          </text>
          
          <text
            [attr.x]="node.x + node.width / 2"
            [attr.y]="node.y + 45"
            fill="#fff"
            font-size="11"
            text-anchor="middle"
            class="node-text"
            opacity="0.9"
          >
            {{ node.span.service }}
          </text>
          
          <text
            [attr.x]="node.x + node.width / 2"
            [attr.y]="node.y + 65"
            fill="#fff"
            font-size="10"
            text-anchor="middle"
            class="node-text"
            opacity="0.9"
          >
            {{ node.span.duration }}ms
          </text>
        </g>
      </g>
    </svg>
  </div>
</div>

