<div class="flamegraph-container" *ngIf="request">
  <div class="flamegraph-header">
    <h4>Flamegraph View</h4>
    <div class="flamegraph-info">
      <span>Duration: {{ request.duration }}ms</span>
      <span>Spans: {{ request.trace.spans.length }}</span>
    </div>
  </div>
  
  <div class="flamegraph-content">
    <div class="flamegraph-chart">
      <svg [attr.width]="'100%'" [attr.height]="(maxDepth + 1) * 60" class="flamegraph-svg">
        <g *ngFor="let node of getAllNodes(rootNodes)">
          <rect
            [attr.x]="node.x + '%'"
            [attr.y]="node.y"
            [attr.width]="node.width + '%'"
            [attr.height]="node.height"
            [attr.fill]="getSpanColor(node.span)"
            stroke="#fff"
            stroke-width="1"
            class="flame-bar"
            [class.error]="node.span.status === 'error'"
            [class.warning]="node.span.status === 'warning'"
            [class.processing]="node.span.status === 'processing'"
            [title]="node.span.name + ' (' + node.span.duration + 'ms)'"
            (click)="onSpanClick(node.span)"
          />
          <text
            *ngIf="node.width > 5"
            [attr.x]="node.x + node.width / 2 + '%'"
            [attr.y]="node.y + node.height / 2 + 5"
            fill="#fff"
            font-size="12"
            font-weight="600"
            text-anchor="middle"
            class="flame-text"
          >
            {{ node.span.name }}
          </text>
          <text
            *ngIf="node.width > 8"
            [attr.x]="node.x + node.width / 2 + '%'"
            [attr.y]="node.y + node.height / 2 + 20"
            fill="#fff"
            font-size="10"
            text-anchor="middle"
            class="flame-text"
            opacity="0.9"
          >
            {{ node.span.service }} ({{ node.span.duration }}ms)
          </text>
        </g>
      </svg>
    </div>
    
    <div class="flamegraph-legend">
      <div class="legend-item">
        <span class="legend-color" style="background: #61affe;"></span>
        <span>Client</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #49cc90;"></span>
        <span>Server</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #764ba2;"></span>
        <span>Database</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #fca130;"></span>
        <span>Cache</span>
      </div>
      <div class="legend-item">
        <span class="legend-color" style="background: #f93e3e;"></span>
        <span>Error</span>
      </div>
    </div>
  </div>
</div>

